# Fraud Detection Dashboard -- Power BI Setup Guide

This guide walks you through building a fraud detection dashboard from scratch in Power BI Desktop. No prior Power BI experience needed.

## Prerequisites

1. **Power BI Desktop** (free): Download from https://powerbi.microsoft.com/desktop/
   - Windows only. On Mac/Linux, use Power BI in a browser via a free Microsoft Fabric trial.
2. **Three CSV files** in the `powerbi/` folder (generated by `scripts/export_for_powerbi.py`):
   - `transactions.csv` -- ~2.77 million rows, one per transaction with model predictions
   - `hourly_summary.csv` -- 48 rows, pre-aggregated stats by hour and transaction type
   - `model_performance.csv` -- 11 rows, confusion matrix and model metrics

---

## Step 1: Import the Data

Repeat these steps for each of the three CSV files:

1. Open Power BI Desktop
2. Click **Home** tab > **Get Data** > **Text/CSV**
3. Navigate to the `powerbi/` folder and select `transactions.csv`
4. A preview window appears -- verify the data looks correct (columns, a few sample rows)
5. Click **Load** (not "Transform Data" -- the CSVs are already clean)
6. Repeat for `hourly_summary.csv` and `model_performance.csv`

You should now see all three tables listed in the **Data** pane on the right side.

## Step 2: Verify Data Types

Click the **Table view** icon (grid icon on the left sidebar) to inspect each table. Check that:

**transactions table:**
| Column | Expected Type | Fix If Wrong |
|---|---|---|
| transaction_id | Whole Number | |
| step | Whole Number | |
| hour | Whole Number | |
| type | Text | |
| amount | Decimal Number | |
| is_fraud | Whole Number | |
| fraud_probability | Decimal Number | |
| predicted_fraud | Whole Number | |
| risk_level | Text | |
| confusion_category | Text | |

**To change a column type:** Click the column header > **Column tools** tab > **Data type** dropdown > select the correct type.

---

## Step 3: Build the Dashboard

Click the **Report view** icon (chart icon, left sidebar). You'll build 7 panels across 2 pages.

### Page 1: Overview Dashboard

---

### Panel 1: KPI Cards (top row)

Create four cards showing key model metrics. Repeat this process four times:

**Card 1 -- Precision:**
1. Click an empty area on the canvas
2. In the **Visualizations** pane (right side), click the **Card** icon (looks like a number in a box)
3. From the **Data** pane, expand `model_performance`
4. Drag `value` into the **Fields** well of the card
5. Now add a filter: in the **Filters** pane (it may say "Filters on this visual"), drag `metric` into the filter area
6. Under the `metric` filter, check only **precision**
7. The card now shows the precision score
8. Click the card title and rename it to **Precision**

**Card 2 -- Recall:** Same steps but filter `metric` to **recall**

**Card 3 -- F1 Score:** Same steps but filter `metric` to **f1_score**

**Card 4 -- Total Fraud Cases:** Same steps but filter `metric` to **total_fraud**. Change the title to **Fraud Cases**

Arrange all four cards in a row across the top of the page.

---

### Panel 2: Transaction Volume by Hour (clustered bar chart)

1. Click an empty area below the KPI cards
2. In **Visualizations**, click the **Clustered bar chart** icon (horizontal bars) -- or use **Clustered column chart** (vertical bars) if you prefer
3. From **Data** pane, expand `hourly_summary`:
   - Drag `hour` to **Y-axis** (or X-axis for column chart)
   - Drag `transaction_count` to **X-axis** (or Y-axis for column chart)
   - Drag `type` to **Legend**
4. You'll see bars grouped by TRANSFER and CASH_OUT for each hour
5. Click **Format** (paint roller icon) > **Title** > rename to **Transaction Volume by Hour**

---

### Panel 3: Fraud Rate by Hour (line chart)

1. Click an empty area next to Panel 2
2. In **Visualizations**, click the **Line chart** icon
3. From `hourly_summary`:
   - Drag `hour` to **X-axis**
   - Drag `fraud_rate_pct` to **Y-axis**
   - Drag `type` to **Legend**
4. You'll see two lines (TRANSFER and CASH_OUT) showing how fraud rate varies by hour
5. Rename the title to **Fraud Rate by Hour (%)**

---

### Panel 4: Risk Level Breakdown (donut chart)

1. Click an empty area
2. In **Visualizations**, click the **Donut chart** icon
3. From `transactions`:
   - Drag `risk_level` to **Legend**
   - Drag `transaction_id` to **Values** (it will auto-count)
4. Rename the title to **Risk Level Distribution**
5. To set custom colours: Click **Format** > **Data colors** and set:
   - HIGH = Red (#E74C3C)
   - MEDIUM = Orange (#F39C12)
   - LOW = Green (#27AE60)

---

### Panel 5: Confusion Matrix (clustered column chart)

1. Click an empty area
2. In **Visualizations**, click the **Clustered column chart** icon
3. From `transactions`:
   - Drag `confusion_category` to **X-axis**
   - Drag `transaction_id` to **Y-axis** (it will auto-count)
4. Rename the title to **Confusion Matrix Breakdown**
5. For custom colours: **Format** > **Data colors**:
   - TP (True Positive) = Green (#27AE60)
   - TN (True Negative) = Light Blue (#3498DB)
   - FP (False Positive) = Orange (#F39C12)
   - FN (False Negative) = Red (#E74C3C)

**Reading this chart:**
- **TP** = Correctly caught fraud
- **TN** = Correctly cleared legitimate transactions
- **FP** = Falsely flagged as fraud (wastes investigation time)
- **FN** = Missed fraud (the dangerous ones)

---

### Panel 6: Fraud Probability Distribution (histogram)

1. Click an empty area
2. In **Visualizations**, click the **Clustered column chart** icon
3. From `transactions`:
   - Drag `fraud_probability` to **X-axis**
   - Drag `transaction_id` to **Y-axis** (it will auto-count)
4. Power BI will automatically bin the probability values
5. Rename the title to **Fraud Probability Distribution**

**What to look for:** Most transactions should cluster near 0.0 (clearly legitimate) or near 1.0 (clearly fraudulent). A good model shows a bimodal distribution with few values in the middle.

---

### Page 2: Transaction Detail (drill-down table)

1. At the bottom of the canvas, click the **+** icon to add a new page
2. Right-click the new page tab and rename it to **Transaction Detail**
3. In **Visualizations**, click the **Table** icon (grid)
4. From `transactions`, drag these columns into the table in order:
   - `transaction_id`
   - `type`
   - `amount`
   - `risk_level`
   - `fraud_probability`
   - `is_fraud`
   - `predicted_fraud`
   - `confusion_category`
5. Click the `fraud_probability` column header in the visual to sort descending (highest risk first)
6. Resize the table to fill most of the page

---

## Step 4: Add Slicers (Filters)

Slicers let you filter all visuals on a page at once. Add these to Page 1:

### Transaction Type Slicer
1. Click an empty area (top-left corner works well)
2. In **Visualizations**, click the **Slicer** icon (funnel)
3. From `transactions`, drag `type` into the **Field** well
4. You'll see buttons for TRANSFER and CASH_OUT -- clicking one filters every visual on the page

### Risk Level Slicer
1. Add another slicer
2. Drag `risk_level` into it
3. Now you can filter the entire page to show only HIGH-risk transactions

### Confusion Category Slicer (on Page 2)
1. On the Transaction Detail page, add a slicer
2. Drag `confusion_category` into it
3. Click **FN** to isolate missed fraud cases for investigation

---

## Step 5: Formatting Tips

- **Title:** Double-click any chart title to rename it
- **Theme:** **View** tab > **Themes** to change the overall look
- **Font size for KPI cards:** Select a card > **Format** > **Callout value** > increase font size to 28-36pt
- **Number formatting:** Select a visual > click the value in **Values** well > **Format** > choose appropriate decimal places
- **Canvas size:** **View** tab > **Page size** > 16:9 is standard for presentations

---

## Data Dictionary

### transactions.csv

| Column | Description |
|---|---|
| `transaction_id` | Unique row identifier (0-based) |
| `step` | Simulation timestep (0-743, each step = 1 hour) |
| `hour` | Hour of day (0-23), derived from step % 24 |
| `type` | TRANSFER or CASH_OUT (only types where fraud occurs) |
| `amount` | Transaction amount in simulated currency |
| `name_orig` | Origin account ID |
| `name_dest` | Destination account ID |
| `oldbalance_orig` | Origin account balance before transaction |
| `newbalance_orig` | Origin account balance after transaction |
| `oldbalance_dest` | Destination account balance before transaction |
| `newbalance_dest` | Destination account balance after transaction |
| `orig_balance_error` | Discrepancy in origin balance (positive = money disappeared) |
| `dest_balance_error` | Discrepancy in destination balance (positive = money didn't arrive) |
| `orig_emptied` | 1 if origin account was drained to zero, 0 otherwise |
| `amount_to_balance_ratio` | Transaction size relative to account balance (high = suspicious) |
| `dest_unchanged` | 1 if destination balance didn't change despite receiving money |
| `is_fraud` | Ground truth: 1 = actually fraudulent, 0 = legitimate |
| `fraud_probability` | Model's estimated probability of fraud (0.0 to 1.0) |
| `predicted_fraud` | Model's binary prediction: 1 if fraud_probability >= 0.3 |
| `risk_level` | HIGH (prob >= 0.7), MEDIUM (0.3-0.7), LOW (< 0.3) |
| `prediction_correct` | 1 if the model got it right, 0 if it got it wrong |
| `confusion_category` | TP (caught fraud), TN (cleared legit), FP (false alarm), FN (missed fraud) |

### hourly_summary.csv

| Column | Description |
|---|---|
| `hour` | Hour of day (0-23) |
| `type` | TRANSFER or CASH_OUT |
| `transaction_count` | Number of transactions in this hour/type bucket |
| `fraud_count` | Number of actually fraudulent transactions |
| `fraud_rate_pct` | Fraud count / transaction count * 100 |
| `predicted_fraud_count` | Number the model flagged as fraud |
| `total_amount` | Total monetary volume |
| `avg_amount` | Average transaction amount |
| `avg_fraud_probability` | Average model confidence score |
| `true_positive_count` | Correctly caught fraud cases |
| `false_positive_count` | Incorrectly flagged legitimate transactions |

### model_performance.csv

| metric | Description |
|---|---|
| `true_positives` | Fraud transactions correctly caught by the model |
| `false_positives` | Legitimate transactions incorrectly flagged |
| `true_negatives` | Legitimate transactions correctly cleared |
| `false_negatives` | Fraud transactions the model missed |
| `precision` | Of all transactions flagged as fraud, what % actually were (higher = fewer false alarms) |
| `recall` | Of all actual fraud, what % did the model catch (higher = fewer missed) |
| `f1_score` | Harmonic mean of precision and recall (overall model quality) |
| `total_transactions` | Total rows in the dataset |
| `total_fraud` | Total actual fraud cases |
| `fraud_rate_pct` | Percentage of transactions that are fraudulent |
| `threshold` | Probability cutoff used to classify fraud (0.3) |

---

## Troubleshooting

**"My CSV won't load"**
- Make sure you ran `python scripts/export_for_powerbi.py` first
- Check the `powerbi/` folder contains all three CSV files
- Try opening the CSV in a text editor to verify it's not empty

**"Numbers show as text"**
- In Power BI, go to **Home** > **Transform Data** (opens Power Query Editor)
- Select the column > **Transform** tab > **Data Type** > choose the correct type
- Click **Close & Apply**

**"Charts are very slow"**
- The transactions table has ~2.77 million rows. First load takes 30-60 seconds while Power BI compresses the data. After that, interactions should be fast.
- If still slow: use the hourly_summary table for overview charts and only use transactions for the detail table and donut chart

**"Card shows sum instead of a single value"**
- Make sure you added a filter on `metric` for that specific card
- Click the value in the **Values** well > change aggregation from "Sum" to "First" or "Don't summarize"

**"I see 0 in all the confusion matrix values"**
- Double-check that the `transaction_id` field is set to "Count" aggregation, not "Sum"
- Right-click `transaction_id` in the Values well > **Count**
